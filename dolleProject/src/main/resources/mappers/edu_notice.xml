<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.edu.noticeBoard">

	<resultMap type="com.edu.noticeBoard.vo.NoticeVo" 
		id="noticeResultMap">
		<id column="NOTICE_IDX" 			property="noticeIdx"/>
		<result column="MEMBER_IDX" 		property="noticeMemberIdx"/>
		<result column="NOTICE_TITLE" 		property="noticeTitle"/>
		<result column="NOTICE_CONTENT" 	property="noticeContent"/>
		<result column="NOTICE_CRE_DATE" 	property="noticeCreDate"
			javaType="java.util.Date"/>
		<result column="NOTICE_MOD_DATE" 	property="noticeModDate"
			javaType="java.util.Date"/>
		<result column="NOTICE_FIXED" 		property="noticeFixed"/>
		<result column="NOTICE_DEL_FLAG" 	property="noticeDelYn"/>
	</resultMap>
	
	<resultMap type="com.edu.noticeBoard.vo.NoticeMemberFileVo"
		id="noticeMemberFileResultMap">
		<id 	column="NOTICE_IDX"					property="noticeIdx"/>
		<result column="MEMBER_IDX" 				property="memberIdx"/>
		<result column="NOTICE_TITLE" 				property="noticeTitle"/>
		<result column="NOTICE_CRE_DATE" 			property="noticeCreDate"
			javaType="java.util.Date"/>
		<result column="NOTICE_MOD_DATE"			property="noticeModDate"
			javaType="java.util.Date"/>
		<result column="NOITCE_FIXED"				property="noticeFixed"/>
		<result column="NOTICE_CONTENT"				property="noticeContent"/>
		<result column="RNUM"						property="rNum"/>
			
		<result column="MEMBER_NICKNAME" 			property="memberNickname"/>
		
		<result column="FILE_EXIST"					property="fileExist"/>
		<result column="NOTICE_STORED_FILE_NAME"	property="fileNoticeStoredName"/>
	</resultMap>
	
	<select id="noticeMemberFileList" parameterType="map"
		resultMap="noticeMemberFileResultMap">
		SELECT NB.NOTICE_IDX, NB.NOTICE_TITLE, NB.NOTICE_CRE_DATE, M.MEMBER_NICKNAME, NVL2(NF.NOTICE_IDX, 1, 0) AS FILE_EXIST
		FROM NOTICEBOARD NB, MEMBER M, NOTICE_FILE NF
		WHERE NB.MEMBER_IDX = M.MEMBER_IDX
		AND NB.NOTICE_IDX = NF.NOTICE_IDX(+)
		ORDER BY NB.NOTICE_IDX DESC
	</select>
	
	<select id="noticeMemberFileFixedList" parameterType="map"
		resultMap="noticeMemberFileResultMap">
		SELECT NB.NOTICE_IDX, NB.NOTICE_TITLE, NB.NOTICE_CRE_DATE, M.MEMBER_NICKNAME, NVL2(NF.NOTICE_IDX, 1, 0) AS FILE_EXIST
		FROM NOTICEBOARD NB, MEMBER M, NOTICE_FILE NF
		WHERE NB.MEMBER_IDX = M.MEMBER_IDX
		AND NB.NOTICE_IDX = NF.NOTICE_IDX(+)
		AND NB.NOTICE_FIXED = 'fixed'
		ORDER BY NB.NOTICE_IDX DESC
	</select>
	
	<select id='noticeDetailSelectOne' parameterType="map"
		resultMap="noticeMemberFileResultMap">
		
		SELECT NB.NOTICE_IDX, NB.NOTICE_TITLE, M.MEMBER_NICKNAME, NB.NOTICE_CRE_DATE, NF.NOTICE_STORED_FILE_NAME, NB.NOTICE_CONTENT
			FROM NOTICEBOARD NB, MEMBER M, NOTICE_FILE NF
			WHERE NB.MEMBER_IDX = M.MEMBER_IDX
			AND NB.NOTICE_IDX = NF.NOTICE_IDX(+)
			AND NB.NOTICE_IDX = #{noticeIdx} 
			ORDER BY NB.NOTICE_IDX DESC
			
	</select>
	
	<select id='noticeFindUpIdx' parameterType="int"
		resultType="int">
		SELECT NIDX AS FINDIDX
		FROM(SELECT ROWNUM RNUM, NIDX 
		     FROM(SELECT NB.NOTICE_IDX AS NIDX
		                FROM NOTICEBOARD NB, MEMBER M, NOTICE_FILE NF
		                WHERE NB.MEMBER_IDX = M.MEMBER_IDX
		                AND NB.NOTICE_IDX = NF.NOTICE_IDX(+)
		                ORDER BY NIDX DESC))
		WHERE RNUM = #{rNum}-1
	</select>
	
	<select id='noticeFindDownIdx' parameterType="int"
		resultType="int">
		SELECT NIDX AS FINDIDX
		FROM(SELECT ROWNUM RNUM, NIDX 
		     FROM(SELECT NB.NOTICE_IDX AS NIDX
		                FROM NOTICEBOARD NB, MEMBER M, NOTICE_FILE NF
		                WHERE NB.MEMBER_IDX = M.MEMBER_IDX
		                AND NB.NOTICE_IDX = NF.NOTICE_IDX(+)
		                ORDER BY NIDX DESC))
		WHERE RNUM = #{rNum}+1	
	</select>
	
	<select id='noticeFindCurrentRow' parameterType="int"
		resultType="int">
		SELECT RNUM AS FINDROW
		FROM(SELECT ROWNUM RNUM, NIDX 
		     FROM(SELECT NB.NOTICE_IDX AS NIDX
		                FROM NOTICEBOARD NB, MEMBER M, NOTICE_FILE NF
		                WHERE NB.MEMBER_IDX = M.MEMBER_IDX
		                AND NB.NOTICE_IDX = NF.NOTICE_IDX(+)
		                ORDER BY NIDX DESC))
		WHERE NIDX = #{noticeIdx}
	</select>	
	
	<insert id='noticeInsertOne' parameterType="com.edu.noticeBoard.vo.NoticeMemberFileVo">
		INSERT INTO NOTICEBOARD
		VALUE(NOTICE_IDX, MEMBER_IDX
			, NOTICE_TITLE, NOTICE_CONTENT, NOTICE_CRE_DATE
			, NOTICE_MOD_DATE, NOTICE_FIXED)
		VALUES(SEQ_NOTICE_NO.NEXTVAL, 1
			, #{memberIdx}, #{noticeContent}, SYSDATE
			, SYSDATE, #{noticeFixed})
	</insert>
</mapper>